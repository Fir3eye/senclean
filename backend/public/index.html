<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cleaning Service — Book Now</title>
    <link rel="stylesheet" href="/style.css" />
    <script src="/config.js"></script>
    <script src="/utils.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  </head>
  <body>
    <div class="header">
      <div class="container row" style="justify-content: space-between;">
        <div>
          <strong id="brand"></strong>
          <div class="small">Professional Home Deep Cleaning in <span id="city"></span></div>
        </div>
        <div class="row">
          <a href="/admin.html" class="button"><button class="secondary">Admin</button></a>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="grid grid-2">
        <div class="card">
          <h2>Book a Cleaning</h2>
          <div id="msg"></div>
          <form id="bookingForm">
            <label>Name*</label>
            <input name="name" placeholder="Your full name" required />
            <label>Phone*</label>
            <input name="phone" placeholder="WhatsApp / mobile" required />
            <label>Address*</label>
            <textarea name="address" rows="3" placeholder="Flat / Street / Landmark" required></textarea>
            <div class="row" style="gap:12px">
              <div style="flex:1">
                <label>City</label>
                <input name="city" placeholder="e.g., Mumbai" />
              </div>
              <div style="flex:1">
                <label>Service Type*</label>
                <select name="serviceType" required>
                  <option value="">Select</option>
                  <option>Home Deep Cleaning</option>
                  <option>Sofa Shampoo</option>
                  <option>Kitchen Deep Cleaning</option>
                  <option>Bathroom Deep Cleaning</option>
                  <option>Move-in / Move-out</option>
                </select>
              </div>
            </div>
            <div class="row" style="gap:12px">
              <div style="flex:1">
                <label>Bedrooms</label>
                <input name="bedrooms" type="number" min="0" placeholder="e.g., 2" />
              </div>
              <div style="flex:1">
                <label>Bathrooms</label>
                <input name="bathrooms" type="number" min="0" placeholder="e.g., 2" />
              </div>
            </div>
            <div class="row" style="gap:12px">
              <div style="flex:1">
                <label>Date</label>
                <input name="date" type="date" />
              </div>
              <div style="flex:1">
                <label>Time</label>
                <input name="time" type="time" />
              </div>
            </div>
            <label>Notes</label>
            <textarea name="notes" rows="2" placeholder="Any special instructions?"></textarea>
            <div class="row" style="justify-content: space-between; margin-top: 12px;">
              <button type="submit">Submit Booking</button>
              <a id="waBtn" class="button" target="_blank"><button type="button" class="secondary">WhatsApp Us</button></a>
            </div>
          </form>
        </div>

        <div class="card">
          <h2>Why Choose Us</h2>
          <ul>
            <li>Experienced & verified cleaning crew</li>
            <li>Eco-friendly supplies on request</li>
            <li>100% satisfaction promise</li>
            <li>Festival & move-in deep cleaning specialists</li>
          </ul>
          <h3>How it works</h3>
          <ol>
            <li>Submit the booking form</li>
            <li>We confirm on WhatsApp/Call</li>
            <li>Team arrives on time</li>
            <li>Pay after service (UPI/Cash)</li>
          </ol>
        </div>
      </div>
      <div class="footer">© <span id="year"></span> <span id="brand2"></span>. All rights reserved.</div>
    </div>

    <script type="text/babel">
      document.getElementById('brand').textContent = window.APP_CONFIG.businessName;
      document.getElementById('brand2').textContent = window.APP_CONFIG.businessName;
      document.getElementById('city').textContent = window.APP_CONFIG.businessCity;
      document.getElementById('year').textContent = new Date().getFullYear();

      const form = document.getElementById('bookingForm');
      const msg = document.getElementById('msg');
      const waBtn = document.getElementById('waBtn');

      function setMsg(type, text) {
        msg.innerHTML = `<div class="${type}">${text}</div>`;
      }

      waBtn.href = waLink(window.APP_CONFIG.whatsappFallback, "Hi, I want to book a home deep cleaning.");

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(form);
        const payload = Object.fromEntries(formData.entries());
        try {
          const res = await fetch('/api/bookings', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });
          const data = await res.json();
          if (!res.ok) throw new Error(data.error || 'Failed');
          setMsg('success', `Booking received! ID: <strong>${data.booking.id}</strong>. We will confirm shortly.`);
          // Update WhatsApp link with pre-filled booking text
          const text = `New Booking Request:%0AName: ${payload.name}%0APhone: ${payload.phone}%0AService: ${payload.serviceType}%0ACity: ${payload.city || ''}%0AAddress: ${payload.address}%0ADate: ${payload.date || ''} ${payload.time || ''}%0ANotes: ${payload.notes || ''}`;
          waBtn.href = waLink(window.APP_CONFIG.whatsappFallback, text);
          form.reset();
        } catch (err) {
          setMsg('error', err.message);
        }
      });
    </script>
  </body>
</html>
